<?php


$servername = "localhost";
$username = "root";
//$username = "root";
$password = "";
//$password = "";
$conn = new PDO("mysql:host=$servername;dbname=ass3task5", $username, $password);
//$conn = new PDO("mysql:host=$servername;dbname=ass3task4", $username, $password);
$conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
$has_error = false;
$error_msg = "";

$actors = array();
$role_types = array();
$film_titles = array();
$film_actor_roles = array();
$radio_query = array();


function fetchAll()
{
    try {

        $GLOBALS['actors'] = $GLOBALS['conn']->query("SELECT * FROM ass3task5.actors ORDER BY ActorID");


        $GLOBALS['role_types'] = $GLOBALS['conn']->query("SELECT * FROM ass3task5.roletypes ORDER BY RoleTypeID");


        $GLOBALS['film_titles'] = $GLOBALS['conn']->query("SELECT * FROM ass3task5.filmtitles ORDER BY FilmTitleID");

        $GLOBALS['film_actor_roles'] = $GLOBALS['conn']->query("SELECT far.FilmTitleID,
                                                                        ft.FilmTitle,
                                                                        ft.FilmDuration,
                                                                        ft.FilmStory,
                                                                        far.ActorID,
                                                                        a.ActorFullName,
                                                                        far.RoleTypeID, 
                                                                        rt.RoleType,                                                                        
                                                                        far.CharacterName, 
                                                                        far.CharacterDescription 
                                                                FROM ass3task5.filmactorroles far 
                                                                LEFT JOIN ass3task5.filmtitles ft on far.FilmTitleID = ft.FilmTitleID
                                                                LEFT JOIN ass3task5.roletypes rt on far.RoleTypeID = rt.RoleTypeID
                                                                LEFT JOIN ass3task5.actors a on far.ActorID = a.ActorID
                                                                ORDER BY far.FilmTitleID");

        if (isset($_POST['query'])) {
            $query_choice = $_POST['query'];
            if ($query_choice == "select_1") {
                $GLOBALS['radio_query'] = $GLOBALS['conn']->query("SELECT far.FilmTitleID,
                                                                        far.ActorID,
                                                                        far.RoleTypeID,                                                                        
                                                                        far.CharacterName, 
                                                                        far.CharacterDescription 
                                                                FROM ass3task5.filmactorroles far 
                                                                ORDER BY CharacterName");
            }
            if ($query_choice == "select_2") {
                $GLOBALS['radio_query'] = $GLOBALS['conn']->query("SELECT far.FilmTitleID,
                                                                        far.ActorID,
                                                                        far.RoleTypeID,                                                                        
                                                                        far.CharacterName, 
                                                                        far.CharacterDescription 
                                                                FROM ass3task5.filmactorroles far 
                                                                WHERE far.CharacterName LIKE '%ac%' ");
            }
            if ($query_choice == "select_3") {
                $GLOBALS['radio_query'] = $GLOBALS['conn']->query("SELECT far.FilmTitleID,
                                                                        far.ActorID,
                                                                        far.RoleTypeID,                                                                        
                                                                        far.CharacterName, 
                                                                        far.CharacterDescription,
                                                                        rt.RoleType
                                                                FROM ass3task5.filmactorroles far 
                                                                INNER JOIN ass3task5.roletypes rt ON rt.RoleTypeID = far.RoleTypeID");
            }
            if ($query_choice == "select_4") {
                $GLOBALS['radio_query'] = $GLOBALS['conn']->query("SELECT far.FilmTitleID,
                                                                        far.ActorID,
                                                                        far.RoleTypeID,                                                                        
                                                                        far.CharacterName, 
                                                                        far.CharacterDescription
                                                                FROM ass3task5.filmactorroles far 
                                                                WHERE far.RoleTypeID = 3 OR far.RoleTypeID = 5");
            }
            if ($query_choice == "select_5") {
                $GLOBALS['radio_query'] = $GLOBALS['conn']->query("SELECT MAX(ft.FilmDuration) AS FilmDuration FROM ass3task5.filmtitles ft ");
            }
        }

    } catch (PDOException $e) {
        $GLOBALS['has_error'] = true;
        $GLOBALS['error_msg'] = "Connection failed: " . $e->getMessage();
    }
}

fetchAll();


?>